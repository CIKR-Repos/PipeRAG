<app-navbar />

<div class="max-w-6xl mx-auto px-6 py-8">

  <!-- Welcome -->
  <div class="mb-8 animate-fade-in">
    <h1 class="text-2xl font-bold text-text-primary tracking-tight">
      {{ greeting() }}, {{ userName() }}
    </h1>
    <p class="text-text-secondary text-sm mt-1">Here's what's happening with your chatbots.</p>
  </div>

  <!-- Stats Cards -->
  @if (loading()) {
    <!-- Skeleton Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      @for (i of [1,2,3,4]; track i) {
        <div class="bg-surface-2 rounded-xl border border-border p-5 flex items-center gap-4 animate-pulse">
          <div class="skeleton w-12 h-12 rounded-xl"></div>
          <div class="flex-1">
            <div class="skeleton h-3 w-20 mb-2.5 rounded"></div>
            <div class="skeleton h-6 w-12 rounded"></div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <div class="bg-surface-2 rounded-xl border border-border p-5 flex items-center gap-4
                  hover:border-accent/20 transition-all duration-300 group stagger-item"
           style="animation-delay: 0ms">
        <div class="w-12 h-12 rounded-xl bg-accent/10 flex items-center justify-center text-accent text-xl
                    group-hover:bg-accent/20 transition-colors">
          &#128193;
        </div>
        <div>
          <p class="text-sm text-text-secondary">Projects</p>
          <p class="text-2xl font-bold text-text-primary">{{ projects().length }}</p>
        </div>
      </div>

      <div class="bg-surface-2 rounded-xl border border-border p-5 flex items-center gap-4
                  hover:border-emerald-500/20 transition-all duration-300 group stagger-item"
           style="animation-delay: 75ms">
        <div class="w-12 h-12 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 text-xl
                    group-hover:bg-emerald-500/20 transition-colors">
          &#128196;
        </div>
        <div>
          <p class="text-sm text-text-secondary">Documents</p>
          <p class="text-2xl font-bold text-text-primary">{{ totalDocs() }}</p>
        </div>
      </div>

      <div class="bg-surface-2 rounded-xl border border-border p-5 flex items-center gap-4
                  hover:border-amber-500/20 transition-all duration-300 group stagger-item"
           style="animation-delay: 150ms">
        <div class="w-12 h-12 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 text-xl
                    group-hover:bg-amber-500/20 transition-colors">
          &#128172;
        </div>
        <div>
          <p class="text-sm text-text-secondary">Queries Today</p>
          <p class="text-2xl font-bold text-text-primary">&mdash;</p>
        </div>
      </div>

      <div class="bg-surface-2 rounded-xl border border-border p-5 flex items-center gap-4
                  hover:border-purple-500/20 transition-all duration-300 group stagger-item"
           style="animation-delay: 225ms">
        <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 text-xl
                    group-hover:bg-purple-500/20 transition-colors">
          &#128190;
        </div>
        <div>
          <p class="text-sm text-text-secondary">Storage</p>
          <p class="text-2xl font-bold text-text-primary">&mdash;</p>
        </div>
      </div>
    </div>
  }

  <!-- Section Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-lg font-bold text-text-primary">Your Projects</h2>
    <button (click)="openCreate()"
            class="bg-accent hover:bg-accent-hover text-white px-5 py-2 rounded-xl
                   font-semibold text-sm cursor-pointer transition-all duration-200
                   shadow-lg shadow-accent/25 hover:shadow-xl hover:shadow-accent/30
                   hover:-translate-y-0.5 active:translate-y-0 border-none">
      + New Project
    </button>
  </div>

  <!-- Loading skeleton -->
  @if (loading()) {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
      @for (s of skeletonCards; track $index) {
        <div class="bg-surface-2 border border-border rounded-2xl p-6 animate-pulse">
          <div class="flex items-center gap-3 mb-4">
            <div class="skeleton w-10 h-10 rounded-xl"></div>
            <div class="skeleton h-5 w-32 rounded"></div>
          </div>
          <div class="skeleton h-3.5 w-full mb-2 rounded"></div>
          <div class="skeleton h-3.5 w-2/3 mb-6 rounded"></div>
          <div class="flex justify-between pt-4 border-t border-border/50">
            <div class="skeleton h-3 w-16 rounded"></div>
            <div class="skeleton h-3 w-12 rounded"></div>
          </div>
        </div>
      }
    </div>

  <!-- Empty state -->
  } @else if (projects().length === 0) {
    <div class="text-center py-24 animate-fade-in">
      <div class="w-20 h-20 rounded-2xl bg-accent/10 flex items-center justify-center text-4xl mx-auto mb-6">
        &#128230;
      </div>
      <h2 class="text-2xl font-bold text-text-primary mb-3 tracking-tight">Create your first chatbot</h2>
      <p class="text-text-secondary mb-8 max-w-md mx-auto">
        Upload documents and build a RAG-powered chatbot in seconds. No code required.
      </p>
      <button (click)="openCreate()"
              class="bg-accent hover:bg-accent-hover text-white px-8 py-3.5 rounded-xl
                     font-semibold cursor-pointer transition-all duration-200 border-none
                     shadow-lg shadow-accent/25 hover:shadow-xl hover:-translate-y-0.5">
        + Create Project
      </button>
    </div>

  <!-- Project grid -->
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
      @for (p of projects(); track p.id; let i = $index) {
        <a [routerLink]="['/projects', p.id, 'chat']"
           class="block bg-surface-2 border border-border rounded-2xl p-6 no-underline
                  text-inherit transition-all duration-300
                  hover:border-accent/30 hover:shadow-lg hover:shadow-accent/5
                  hover:-translate-y-0.5 group stagger-item"
           [style.animation-delay]="staggerDelay(i)">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-lg
                        group-hover:bg-accent/20 transition-colors">
              &#128172;
            </div>
            <h3 class="text-base font-bold text-text-primary truncate flex-1">{{ p.name }}</h3>
          </div>
          @if (p.description) {
            <p class="text-text-secondary text-sm mb-4 leading-relaxed line-clamp-2">{{ p.description }}</p>
          } @else {
            <div class="mb-4"></div>
          }
          <div class="flex justify-between text-text-tertiary text-xs pt-3 border-t border-border/50">
            <span class="flex items-center gap-1.5">&#128196; {{ p.documentCount }} docs</span>
            <span>{{ timeAgo(p.updatedAt ?? p.createdAt) }}</span>
          </div>
        </a>
      }

      <!-- Add new card -->
      <button (click)="openCreate()"
              class="flex flex-col items-center justify-center gap-3 border-2 border-dashed
                     border-border rounded-2xl p-6 min-h-[180px] bg-transparent
                     text-text-tertiary cursor-pointer hover:border-accent/40
                     hover:text-accent transition-all duration-300">
        <div class="w-12 h-12 rounded-full bg-surface-2 flex items-center justify-center
                    text-xl text-accent border border-border">+</div>
        <span class="font-medium text-sm">New Project</span>
      </button>
    </div>
  }
</div>

<!-- Create Dialog -->
@if (showCreate()) {
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[200] animate-fade-in"
       (click)="closeCreate()">
    <div class="bg-surface-2 border border-border rounded-2xl p-8 w-[90%] max-w-md
                shadow-2xl shadow-black/30 animate-scale-in"
         (click)="$event.stopPropagation()">
      <h2 class="text-xl font-bold text-text-primary mb-6 tracking-tight">Create New Project</h2>
      <form (ngSubmit)="createProject()">
        <label class="block text-sm font-medium text-text-secondary mb-2">Project Name</label>
        <input type="text" [(ngModel)]="newName" name="name" placeholder="My Chatbot" required autofocus
               class="w-full px-4 py-3 bg-surface-1 border border-border rounded-xl text-sm
                      text-text-primary placeholder:text-text-muted mb-5
                      focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20
                      transition-all duration-200" />

        <label class="block text-sm font-medium text-text-secondary mb-2">Description (optional)</label>
        <textarea [(ngModel)]="newDesc" name="desc" placeholder="What is this project for?" rows="3"
                  class="w-full px-4 py-3 bg-surface-1 border border-border rounded-xl text-sm
                         text-text-primary placeholder:text-text-muted mb-6 font-[inherit] resize-none
                         focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20
                         transition-all duration-200"></textarea>

        <div class="flex justify-end gap-3">
          <button type="button" (click)="closeCreate()"
                  class="bg-surface-3 text-text-primary px-5 py-2.5 rounded-xl font-medium text-sm
                         cursor-pointer hover:bg-surface-3/80 transition-all duration-200 border-none">
            Cancel
          </button>
          <button type="submit" [disabled]="creating() || !newName.trim()"
                  class="bg-accent hover:bg-accent-hover text-white px-6 py-2.5 rounded-xl
                         font-semibold text-sm cursor-pointer transition-all duration-200 border-none
                         shadow-lg shadow-accent/25 hover:shadow-xl
                         disabled:opacity-50 disabled:cursor-not-allowed">
            {{ creating() ? 'Creating...' : 'Create Project' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
